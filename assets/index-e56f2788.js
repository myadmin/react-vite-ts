import{ae as i,r as d,n as u,j as e,af as g,ai as w,aj as v,ak as y,al as D,B as m,am as N}from"./index-4f38f5ec.js";import{M as I,S as T,u as F,T as L}from"./index-af8ae3be.js";import{T as A}from"./index-c2c31820.js";import"./useBreakpoint-1fe58ea1.js";const R=n=>{const[t]=i.useForm(),[c,p]=d.useState("create"),[a,x]=d.useState(!1),[h,j]=d.useState([]),[f,s]=d.useState([]);d.useImperativeHandle(n.mRef,()=>({open:r}));const r=(l,k)=>{p(l),x(!0),b(),k&&t.setFieldsValue(k)},C=async()=>{await t.validateFields()&&(c==="create"?await u.createDept(t.getFieldsValue()):await u.editDept(t.getFieldsValue()),w.success("操作成功"),o(),n.update())},o=()=>{x(!1),t.resetFields()},b=async()=>{const l=await u.getDeptList();j(l)},S=async()=>{const l=await u.getAllUserList();s(l)};return d.useEffect(()=>{S()},[]),e.jsx(I,{title:c==="create"?"新增部门":"编辑部门",width:600,okText:"确定",cancelText:"取消",open:a,onOk:C,onCancel:o,children:e.jsxs(i,{form:t,labelCol:{span:4},wrapperCol:{span:20},labelAlign:"right",children:[e.jsx(i.Item,{name:"_id",hidden:!0,children:e.jsx(g,{})}),e.jsx(i.Item,{label:"上级部门",name:"parentId",children:e.jsx(A,{placeholder:"请选择上级部门",allowClear:!0,treeDefaultExpandAll:!0,fieldNames:{label:"deptName",value:"_id"},treeData:h})}),e.jsx(i.Item,{label:"部门名称",name:"deptName",rules:[{required:!0,message:"请输入部门名称"}],children:e.jsx(g,{placeholder:"请输入部门名称"})}),e.jsx(i.Item,{label:"负责人",name:"userName",rules:[{required:!0,message:"请选择负责人"}],children:e.jsx(T,{children:f.map(l=>e.jsx(T.Option,{value:l.userName,children:l.userName},l._id))})})]})})},_=({form:n,onSearch:t,onReset:c})=>e.jsx(i,{className:"searchForm",form:n,layout:"inline",children:e.jsxs(v,{style:{width:"100%"},children:[e.jsx(y,{span:8,children:e.jsx(i.Item,{label:"部门名称",name:"deptName",children:e.jsx(g,{placeholder:"请输入部门名称",allowClear:!0})})}),e.jsx(y,{span:8,offset:8,style:{textAlign:"right"},children:e.jsxs(D,{children:[e.jsx(m,{type:"primary",onClick:t,children:"搜索"}),e.jsx(m,{type:"default",onClick:c,children:"重置"})]})})]})}),E=({handleClickEdit:n,handleClickDelete:t,handleClickSubCreate:c})=>[{title:"部门名称",dataIndex:"deptName",key:"deptName"},{title:"负责人",dataIndex:"userName",key:"userName"},{title:"更新时间",dataIndex:"updateTime",key:"updateTime",render:a=>N(a)},{title:"创建时间",dataIndex:"createTime",key:"createTime",render:a=>N(a)},{title:"操作",key:"action",render:a=>e.jsxs(D,{children:[e.jsx(m,{type:"text",onClick:()=>c(a._id),children:"新增"}),e.jsx(m,{type:"text",onClick:()=>n(a),children:"编辑"}),e.jsx(m,{type:"text",danger:!0,onClick:()=>t(a._id),children:"删除"})]})}],U=()=>{const[n]=i.useForm(),t=d.useRef(),c=async({current:s,pageSize:r},C)=>{const o=await u.getDeptList(C),b=Math.ceil(o.length/r);return{list:o,total:o.length,totalPages:b,current:s}},{tableProps:p,search:a}=F(c,{form:n,defaultCurrent:1,defaultPageSize:100}),x=s=>{var r;(r=t.current)==null||r.open("create",{parentId:s})},h=s=>{var r;(r=t.current)==null||r.open("edit",s)},j=s=>{I.confirm({title:"提示",content:"确定删除该部门吗？",okText:"确定",cancelText:"取消",onOk:async()=>{await u.deleteDept({_id:s}),w.success("删除成功"),a.submit()}})},f=()=>{var s;(s=t.current)==null||s.open("create")};return e.jsxs("div",{children:[e.jsx(_,{form:n,onSearch:a.submit,onReset:a.reset}),e.jsxs("div",{className:"baseTable",children:[e.jsxs("div",{className:"headerWrapper",children:[e.jsx("div",{className:"title",children:"部门列表"}),e.jsx("div",{className:"action",children:e.jsx(m,{type:"primary",onClick:f,children:"新增"})})]}),e.jsx(L,{bordered:!0,rowKey:"_id",columns:E({handleClickSubCreate:x,handleClickEdit:h,handleClickDelete:j}),...p,loading:!1,pagination:!1})]}),e.jsx(R,{mRef:t,update:a.submit})]})};export{U as default};
