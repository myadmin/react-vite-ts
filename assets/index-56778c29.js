import{ae as c,r as n,j as e,af as y,ai as R,aj as _,ak as S,al as I,B as x,n as L,am as v}from"./index-4f38f5ec.js";import{a as f}from"./role-6278619b.js";import{M as T,n as A,u as E,T as M}from"./index-af8ae3be.js";import"./useBreakpoint-1fe58ea1.js";const P=l=>{const[s]=c.useForm(),[i,u]=n.useState(!1),[a,o]=n.useState("create");n.useImperativeHandle(l.mRef,()=>({open:k}));const k=(m,t)=>{o(m),u(!0),t&&s.setFieldsValue(t)},r=async()=>{if(await s.validateFields()){const t=s.getFieldsValue();a==="create"?await f.createRole(t):await f.editRole(t),R.success("操作成功"),p(),l.update()}},p=()=>{u(!1),s.resetFields()};return e.jsx(T,{title:a==="create"?"新增角色":"编辑角色",open:i,width:600,okText:"确定",cancelText:"取消",onOk:r,onCancel:p,children:e.jsxs(c,{form:s,labelCol:{span:4},wrapperCol:{span:20},labelAlign:"right",children:[e.jsx(c.Item,{name:"_id",hidden:!0,children:e.jsx(y,{})}),e.jsx(c.Item,{label:"角色名称",name:"roleName",rules:[{required:!0,message:"请输入角色名称"}],children:e.jsx(y,{placeholder:"请输入角色名称"})}),e.jsx(c.Item,{label:"备注",name:"remark",children:e.jsx(y.TextArea,{placeholder:"请输入备注"})})]})})},D=({form:l,onSearch:s,onReset:i})=>e.jsx(c,{className:"searchForm",form:l,layout:"inline",children:e.jsxs(_,{style:{width:"100%"},children:[e.jsx(S,{span:8,children:e.jsx(c.Item,{label:"角色名称",name:"roleName",children:e.jsx(y,{placeholder:"请输入角色名称",allowClear:!0})})}),e.jsx(S,{span:8,offset:8,style:{textAlign:"right"},children:e.jsxs(I,{children:[e.jsx(x,{type:"primary",onClick:s,children:"搜索"}),e.jsx(x,{type:"default",onClick:i,children:"重置"})]})})]})}),V=l=>{const[s,i]=n.useState(!1),[u,a]=n.useState([]),[o,k]=n.useState([]),[r,p]=n.useState(),[m,t]=n.useState();n.useImperativeHandle(l.mRef,()=>({open:d}));const d=(C,h)=>{i(!0),p(h),a((h==null?void 0:h.permissionList.checkedKeys)||[])},b=async()=>{m&&(await f.updateRolePermission(m),R.success("设置成功"),j(),l.update())},j=()=>{i(!1),t(void 0)},F=(C,h)=>{a(C);const w=[],N=[];h.checkedNodes.forEach(g=>{g.menuType===2?w.push(g._id):N.push(g._id)}),t({_id:(r==null?void 0:r._id)||"",permissionList:{checkedKeys:w,halfCheckedKeys:N.concat(h.halfCheckedKeys)}})},K=async()=>{const C=await L.getMenuList();k(C)};return n.useEffect(()=>{K()},[]),e.jsx(T,{title:"设置权限",open:s,width:600,okText:"确定",cancelText:"取消",onOk:b,onCancel:j,children:e.jsxs(c,{labelCol:{span:4},wrapperCol:{span:20},labelAlign:"right",children:[e.jsx(c.Item,{label:"角色名称",children:r==null?void 0:r.roleName}),e.jsx(c.Item,{label:"权限",children:e.jsx(A,{checkable:!0,defaultExpandAll:!0,fieldNames:{title:"menuName",key:"_id",children:"children"},selectable:!1,onCheck:F,checkedKeys:u,treeData:o})})]})})},O=({handleClickEdit:l,handleClickSetting:s,handleClickDelete:i})=>[{title:"角色名称",dataIndex:"roleName",key:"roleName"},{title:"备注",dataIndex:"remark",key:"remark"},{title:"更新时间",dataIndex:"updateTime",key:"updateTime",render:a=>v(a)},{title:"创建时间",dataIndex:"createTime",key:"createTime",render:a=>v(a)},{title:"操作",key:"action",render:a=>e.jsxs(I,{children:[e.jsx(x,{type:"text",onClick:()=>l(a),children:"编辑"}),e.jsx(x,{type:"text",onClick:()=>s(a),children:"设置权限"}),e.jsx(x,{type:"text",danger:!0,onClick:()=>i(a._id),children:"删除"})]})}],W=()=>{const[l]=c.useForm(),s=n.useRef(),i=n.useRef(),u=async({current:t,pageSize:d},b)=>{const j=await f.getRoleList({...b,pageNum:t,pageSize:d});return{list:j.list,total:j.page.total}},{tableProps:a,search:o}=E(u,{form:l,defaultPageSize:10}),k=()=>{var t;(t=s.current)==null||t.open("create")},r=t=>{var d;(d=s.current)==null||d.open("edit",t)},p=t=>{var d;(d=i.current)==null||d.open("edit",t)},m=t=>{T.confirm({title:"提示",content:"确定删除该角色吗？",okText:"确定",cancelText:"取消",onOk:async()=>{await f.deleteRole({_id:t}),R.success("删除成功"),o.submit()}})};return e.jsxs("div",{className:"role-list",children:[e.jsx(D,{form:l,onSearch:o.submit,onReset:o.reset}),e.jsxs("div",{className:"baseTable",children:[e.jsxs("div",{className:"headerWrapper",children:[e.jsx("div",{className:"title",children:"角色列表"}),e.jsx("div",{className:"action",children:e.jsx(x,{type:"primary",onClick:k,children:"新增"})})]}),e.jsx(M,{rowKey:"_id",bordered:!0,columns:O({handleClickEdit:r,handleClickSetting:p,handleClickDelete:m}),...a,loading:!1})]}),e.jsx(P,{mRef:s,update:o.submit}),e.jsx(V,{mRef:i,update:o.submit})]})};export{W as default};
