import{ae as t,r as x,n as p,j as e,af as d,an as v,ai as g,aj as w,ak as k,al as T,B as m,am as M}from"./index-4f38f5ec.js";import{M as S,R as o,S as I,u as F,T as N}from"./index-af8ae3be.js";import{T as R}from"./index-c2c31820.js";import"./useBreakpoint-1fe58ea1.js";const L=i=>{const[n]=t.useForm(),[c,h]=x.useState("create"),[a,j]=x.useState(!1),[b,C]=x.useState([]);x.useImperativeHandle(i.mRef,()=>({open:f}));const f=(r,y)=>{h(r),j(!0),u(),y&&n.setFieldsValue(y)},l=async()=>{await n.validateFields()&&(c==="create"?await p.createMenu(n.getFieldsValue()):await p.editMenu(n.getFieldsValue()),g.success("操作成功"),s(),i.update())},s=()=>{j(!1),n.resetFields()},u=async()=>{const r=await p.getMenuList();C(r)};return e.jsx(S,{title:c==="create"?"创建菜单":"编辑菜单",width:600,okText:"确定",cancelText:"取消",open:a,onOk:l,onCancel:s,children:e.jsxs(t,{form:n,labelCol:{span:4},wrapperCol:{span:20},labelAlign:"right",initialValues:{menuType:1,menuState:1},children:[e.jsx(t.Item,{name:"_id",hidden:!0,children:e.jsx(d,{})}),e.jsx(t.Item,{label:"父级菜单",name:"parentId",children:e.jsx(R,{placeholder:"请选择父级菜单",allowClear:!0,treeDefaultExpandAll:!0,fieldNames:{label:"menuName",value:"_id"},treeData:b})}),e.jsx(t.Item,{label:"菜单类型",name:"menuType",children:e.jsxs(o.Group,{children:[e.jsx(o,{value:1,children:"菜单"}),e.jsx(o,{value:2,children:"按钮"}),e.jsx(o,{value:3,children:"页面"})]})}),e.jsx(t.Item,{label:"菜单名称",name:"menuName",rules:[{required:!0,message:"请输入菜单名称"}],children:e.jsx(d,{placeholder:"请输入菜单名称"})}),e.jsx(t.Item,{shouldUpdate:!0,noStyle:!0,children:({getFieldValue:r})=>r("menuType")===2?e.jsx(t.Item,{label:"权限标识",name:"menuCode",children:e.jsx(d,{placeholder:"请输入菜单图标"})}):e.jsxs(e.Fragment,{children:[e.jsx(t.Item,{label:"菜单图标",name:"icon",children:e.jsx(d,{placeholder:"请输入菜单图标"})}),e.jsx(t.Item,{label:"路由地址",name:"path",children:e.jsx(d,{placeholder:"请输入路由地址"})}),e.jsx(t.Item,{label:"组件名称",name:"component",children:e.jsx(d,{placeholder:"请输入组件名称"})})]})}),e.jsx(t.Item,{label:"排序",name:"orderBy",tooltip:{title:"菜单排序值，值越小越靠前",icon:e.jsx(v,{})},children:e.jsx(d,{type:"number",placeholder:"请输入排序值"})}),e.jsx(t.Item,{label:"菜单状态",name:"menuState",children:e.jsxs(o.Group,{children:[e.jsx(o,{value:1,children:"正常"}),e.jsx(o,{value:2,children:"禁用"})]})})]})})},V=({form:i,onSearch:n,onReset:c})=>e.jsx(t,{className:"searchForm",form:i,layout:"inline",initialValues:{menuState:1},children:e.jsxs(w,{style:{width:"100%"},children:[e.jsx(k,{span:8,children:e.jsx(t.Item,{label:"菜单名称",name:"menuName",children:e.jsx(d,{placeholder:"请输入菜单名称",allowClear:!0})})}),e.jsx(k,{span:8,children:e.jsx(t.Item,{label:"菜单状态",name:"menuState",children:e.jsxs(I,{placeholder:"请选择菜单状态",allowClear:!0,children:[e.jsx(I.Option,{value:1,children:"正常"}),e.jsx(I.Option,{value:2,children:"禁用"})]})})}),e.jsx(k,{span:8,style:{textAlign:"right"},children:e.jsxs(T,{children:[e.jsx(m,{type:"primary",onClick:n,children:"搜索"}),e.jsx(m,{type:"default",onClick:c,children:"重置"})]})})]})}),_=({handleClickEdit:i,handleClickDelete:n,handleClickSubCreate:c})=>[{title:"菜单名称",dataIndex:"menuName",key:"menuName"},{title:"菜单图标",dataIndex:"icon",key:"icon"},{title:"菜单类型",dataIndex:"menuType",key:"menuType",render:a=>({1:"菜单",2:"按钮",3:"页面"})[a]},{title:"权限标识",dataIndex:"menuCode",key:"menuCode"},{title:"路由地址",dataIndex:"path",key:"path"},{title:"组件名称",dataIndex:"component",key:"component"},{title:"状态",dataIndex:"menuState",key:"menuState",render:a=>({1:"正常",2:"禁用"})[a]},{title:"创建时间",dataIndex:"createTime",key:"createTime",render:a=>M(a)},{title:"操作",key:"action",render:a=>e.jsxs(T,{children:[e.jsx(m,{type:"text",onClick:()=>c(a),children:"新增"}),e.jsx(m,{type:"text",onClick:()=>i(a),children:"编辑"}),e.jsx(m,{type:"text",danger:!0,onClick:()=>n(a),children:"删除"})]})}],E=()=>{const[i]=t.useForm(),n=x.useRef(),c=async({current:l,pageSize:s},u)=>{const r=await p.getMenuList(u),y=Math.ceil(r.length/s);return{list:r,total:r.length,totalPages:y,current:l}},{tableProps:h,search:a}=F(c,{form:i,defaultCurrent:1,defaultPageSize:100}),j=l=>{var s,u;(u=n.current)==null||u.open("create",{parentId:l._id,orderBy:((s=l.children)==null?void 0:s.length)||0})},b=l=>{var s;(s=n.current)==null||s.open("edit",l)},C=l=>{const s={1:"菜单",2:"按钮",3:"页面"};S.confirm({title:"提示",content:`确定删除该${s[l.menuType]}吗？`,okText:"确定",cancelText:"取消",onOk:async()=>{await p.deleteMenu({_id:l._id}),g.success("删除成功"),a.submit()}})},f=()=>{var l;(l=n.current)==null||l.open("create",{orderBy:h.dataSource.length})};return e.jsxs("div",{children:[e.jsx(V,{form:i,onSearch:a.submit,onReset:a.reset}),e.jsxs("div",{className:"baseTable",children:[e.jsxs("div",{className:"headerWrapper",children:[e.jsx("div",{className:"title",children:"菜单列表"}),e.jsx("div",{className:"action",children:e.jsx(m,{type:"primary",onClick:f,children:"新增"})})]}),e.jsx(N,{bordered:!0,rowKey:"_id",columns:_({handleClickSubCreate:j,handleClickEdit:b,handleClickDelete:C}),...h,loading:!1,pagination:!1})]}),e.jsx(L,{mRef:n,update:a.submit})]})};export{E as default};
